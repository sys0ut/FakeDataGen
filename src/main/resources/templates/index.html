<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fake Data Generator</title>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <div class="container-narrow">
        <div class="brand" style="margin-bottom:18px;">
            <span style="font-size:1.1rem;color:#8b93a7;">Fake Data Generator</span>
        </div>

        <!-- ì—°ê²° ì„¤ì • -->
        <div class="panel" style="margin-bottom:16px;">
            <div class="panel-header"><span>ì—°ê²° ì„¤ì •</span><button class="btn btn-ghost" onclick="testConnection()">ì—°ê²° í…ŒìŠ¤íŠ¸</button></div>
            <div class="panel-body">
                <div class="grid grid-2">
                    <div>
                        <label for="dbHost">í˜¸ìŠ¤íŠ¸</label>
                        <input type="text" id="dbHost" name="dbHost">
                    </div>
                    <div>
                        <label for="dbPort">í¬íŠ¸</label>
                        <input type="number" id="dbPort" name="dbPort">
                    </div>
                    <div>
                        <label for="dbName">DB ì´ë¦„</label>
                        <input type="text" id="dbName" name="dbName">
                    </div>
                    <div>
                        <label for="dbUsername">ì‚¬ìš©ì</label>
                        <input type="text" id="dbUsername" name="dbUsername">
                    </div>
                    <div>
                        <label for="dbPassword">ë¹„ë°€ë²ˆí˜¸</label>
                        <input type="password" id="dbPassword" name="dbPassword">
                    </div>
                </div>
            </div>
        </div>

        <!-- ìŠ¤í‚¤ë§ˆ ì…ë ¥ -->
        <div class="panel">
            <div class="panel-header"><span>ìŠ¤í‚¤ë§ˆ ì…ë ¥</span></div>
            <div class="panel-body">
                <form th:action="@{/parse}" method="post" onsubmit="addDbInfoToForm(this)">
                            <!-- ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì •ë³´ë¥¼ ìˆ¨ê²¨ì§„ í•„ë“œë¡œ ì¶”ê°€ -->
                            <input type="hidden" name="dbHost" id="formDbHost">
                            <input type="hidden" name="dbPort" id="formDbPort">
                            <input type="hidden" name="dbName" id="formDbName">
                            <input type="hidden" name="dbUsername" id="formDbUsername">
                            <input type="hidden" name="dbPassword" id="formDbPassword">
                            
                    <div class="mb-3">
                        <label for="schemaText">CUBRID DDL ìŠ¤í‚¤ë§ˆ</label>
                        <textarea id="schemaText" name="schemaText" required></textarea>
                    </div>
                            
                    <div class="grid grid-3">
                        <div>
                            <label for="recordCount">ë ˆì½”ë“œ ìˆ˜</label>
                            <input type="number" id="recordCount" name="recordCount" min="1" max="1000000" value="100000">
                        </div>
                        <div>
                            <label>DB INSERT</label>
                            <div style="margin-top:8px">
                                <input type="checkbox" id="insertToDatabase" name="insertToDatabase" value="true"> <span class="muted">ì‹¤ì œ DBì— ì €ì¥</span>
                            </div>
                        </div>
                        <div>
                            <label>CUBRID ë²„ì „</label>
                            <div style="margin-top:8px">
                                <input type="checkbox" id="cubridVersion112" name="cubridVersion112" value="true"> <span class="muted">11.2 ì´ìƒ</span>
                            </div>
                        </div>
                    </div>
                    <div class="spacer"></div>
                    <button type="submit" class="btn btn-primary">ê°€ì§œ ë°ì´í„° ìƒì„±</button>
                        </form>
                    </div>
                </div>
                
                <div class="muted" style="margin-top:14px">CREATE/ALTER CLASS ì¤‘ì‹¬ì˜ DDLì„ ì§€ì›í•©ë‹ˆë‹¤.</div>
            </div>
        </div>
    </div>
    <script>
        function addDbInfoToForm(form) {
            // ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì •ë³´ë¥¼ í¼ì— ì¶”ê°€
            const dbHost = document.getElementById('dbHost').value;
            const dbPort = document.getElementById('dbPort').value;
            const dbName = document.getElementById('dbName').value;
            const dbUsername = document.getElementById('dbUsername').value;
            const dbPassword = document.getElementById('dbPassword').value;
            const insertToDatabase = document.getElementById('insertToDatabase').checked;
            
            console.log('í¼ ì œì¶œ ì‹œ ë°ì´í„°ë² ì´ìŠ¤ ì •ë³´:');
            console.log('dbHost:', dbHost);
            console.log('dbPort:', dbPort);
            console.log('dbName:', dbName);
            console.log('dbUsername:', dbUsername);
            console.log('dbPassword:', dbPassword ? '***' : 'null');
            console.log('insertToDatabase:', insertToDatabase);
            
            document.getElementById('formDbHost').value = dbHost;
            document.getElementById('formDbPort').value = dbPort;
            document.getElementById('formDbName').value = dbName;
            document.getElementById('formDbUsername').value = dbUsername;
            document.getElementById('formDbPassword').value = dbPassword;
            
            return true;
        }
        
        function testConnection() {
            const formData = new FormData();
            formData.append('dbHost', document.getElementById('dbHost').value);
            formData.append('dbPort', document.getElementById('dbPort').value);
            formData.append('dbName', document.getElementById('dbName').value);
            formData.append('dbUsername', document.getElementById('dbUsername').value);
            formData.append('dbPassword', document.getElementById('dbPassword').value);
            
            // ë²„íŠ¼ ë¹„í™œì„±í™”
            const testBtn = document.querySelector('button[onclick="testConnection()"]');
            testBtn.disabled = true;
            testBtn.innerHTML = 'ğŸ”„ í…ŒìŠ¤íŠ¸ ì¤‘...';
            
            fetch('/test-connection', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                const alertClass = data.success ? 'alert-success' : 'alert-danger';
                const alertHtml = `<div class="alert ${alertClass} alert-dismissible fade show" role="alert">
                    ${data.message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>`;
                
                // ê¸°ì¡´ ì•Œë¦¼ ì œê±°
                const existingAlert = document.querySelector('.card-body .alert');
                if (existingAlert) {
                    existingAlert.remove();
                }
                
                // ìƒˆ ì•Œë¦¼ ì¶”ê°€
                document.querySelector('.card-body').insertAdjacentHTML('afterbegin', alertHtml);
            })
            .catch(error => {
                console.error('Error:', error);
                const alertHtml = `<div class="alert alert-danger alert-dismissible fade show" role="alert">
                    ì—°ê²° í…ŒìŠ¤íŠ¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>`;
                
                const existingAlert = document.querySelector('.card-body .alert');
                if (existingAlert) {
                    existingAlert.remove();
                }
                
                document.querySelector('.card-body').insertAdjacentHTML('afterbegin', alertHtml);
            })
            .finally(() => {
                // ë²„íŠ¼ ë‹¤ì‹œ í™œì„±í™”
                testBtn.disabled = false;
                testBtn.innerHTML = 'ğŸ” ì—°ê²° í…ŒìŠ¤íŠ¸';
            });
        }
    </script>
</body>
</html>
